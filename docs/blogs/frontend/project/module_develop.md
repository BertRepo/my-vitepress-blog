---
description: ğŸ’ æœ¬æ–‡ä»å¼€å‘ä¸€ä¸ªå®ç°æ·±æ‹·è´çš„åº“ä¸ºä¾‹ï¼Œè®²è¿°ä¸€ä¸‹ js åº“çš„å¼€å‘æµç¨‹ã€‚
title: jsåº“å¼€å‘
author: Bert
date: 2022-03-09
hidden: false
comment: true
sticky: 112
top: 117
recommend: 19
tag:
  - å‰ç«¯
category:
  - å·¥ç¨‹åŒ–
---

# js åº“å¼€å‘æµç¨‹

> é¢˜å¤–è¯ï¼Œä¸ºä»€ä¹ˆè¦åšæ·±æ‹·è´å‘¢ï¼Ÿ

> åœ¨ JS ä¸­ï¼Œæ•°æ®ç±»å‹åˆ†ä¸ºåŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹ä¸¤ç§ï¼Œå¯¹äºåŸºæœ¬æ•°æ®ç±»å‹æ¥è¯´ï¼Œå®ƒçš„å€¼ç›´æ¥å­˜å‚¨åœ¨æ ˆå†…å­˜ä¸­ï¼Œè€Œå¯¹äºå¼•ç”¨ç±»å‹æ¥è¯´ï¼Œå®ƒåœ¨æ ˆå†…å­˜ä¸­ä»…ä»…å­˜å‚¨äº†ä¸€ä¸ªå¼•ç”¨ï¼Œè€ŒçœŸæ­£çš„æ•°æ®å­˜å‚¨åœ¨å †å†…å­˜ä¸­ã€‚

> åœ¨å°†ä¸€ä¸ªå˜é‡èµ‹äºˆç»™å¦ä¸€ä¸ªå˜é‡æ—¶ï¼Œ åŸºç¡€ç±»å‹å˜é‡èµ‹äºˆçš„å°±æ˜¯å˜é‡å€¼ï¼Œè€Œå¼•ç”¨æ•°æ®ç±»å‹åªæ˜¯å°†åœ¨å †æ ˆä¸­çš„å¼•ç”¨èµ‹äºˆç»™äº†å…¶ä»–å˜é‡ï¼Œä»–ä»¬æ‰€æŒ‡å‘çš„æ˜¯å †å†…å­˜ä¸­åŒä¸€ä¸ªæ•°æ®ã€‚å¯¹äºå¼•ç”¨ç±»å‹è¿™ç§æƒ…å†µè€Œè¨€ï¼Œè¿™å°±å­˜åœ¨ä¸€ç§é—®é¢˜ï¼Œæ”¹å˜äº†å…¶ä¸­ä¸€ä¸ªå˜é‡çš„å€¼æ—¶ï¼Œä¹Ÿå°±æ˜¯æ”¹å˜äº†å †å†…å­˜ä¸­æ•°æ®ï¼Œé‚£ä¹ˆæŒ‡å‘ä»–çš„å…¶ä»–å˜é‡çš„å€¼ä¹Ÿå°±éƒ½æ”¹å˜äº†ã€‚

> å› æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨æ”¹å˜æ–°çš„å¼•ç”¨æ•°æ®ç±»å‹å˜é‡ï¼ˆæ•°ç»„æˆ–å¯¹è±¡ï¼‰çš„æ—¶å€™ï¼Œä¸æ”¹å˜å…¶åŸå¼•ç”¨æ•°æ®å˜é‡ï¼ˆåŸæ•°ç»„æˆ–åŸå¯¹è±¡ï¼‰çš„å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦åœ¨å°†åŸå˜é‡ï¼ˆå¼•ç”¨æ•°æ®ç±»å‹ï¼‰çš„å€¼èµ‹äºˆå…¶ä»–å˜é‡æ—¶ï¼Œä½¿ç”¨æ·±æ‹·è´ã€‚

## å¸¸ç”¨å®ç°

æ—¥å¸¸ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€äº›åº“å‡½æ•°å¦‚ lodash çš„_.cloneDeepæˆ–è€…ä½¿ç”¨JSON.parse(JSON.stringify(obj))æ¥å®ç°ã€‚

## æ·±æ‹·è´ä»£ç å®ç°

æœ‰äº†ç›®çš„å½“ç„¶æ˜¯å…ˆå»å®ç°ä»–å•Šï¼Œæ·±æ‹·è´çš„ä»£ç å¦‚ä¸‹ï¼ˆä»£ç ç†è§£è¯·å‚è€ƒæ³¨é‡Šï¼‰ï¼š

```javascript
/*
 * @Description: jsåº“å¼€å‘ç¤ºä¾‹â€”â€”â€”â€”æ·±æ‹·è´çš„åº“
 * @Author: Bert
 * @Date: 2023-03-29 12:48:31
 * @LastEditors: Bert
 * @LastEditTime: 2023-03-29 17:04:45
 */

/**
 * åˆ¤æ–­æ•°æ®ç±»å‹
 */
function type(data) {
  // è¿”å›å¯¹è±¡æ•°æ®ç±»å‹çš„å­—ç¬¦ä¸²ï¼Œå½¢å¼å¦‚[object type]ï¼Œ
  // ä»ç¬¬å…«ä½æˆªå–å­—ç¬¦ä¸²ï¼Œæˆªæ­¢å€’æ•°ç¬¬ä¸€ä½å¹¶ä¸åŒ…å«å€’æ•°ç¬¬ä¸€ä½å­—ç¬¦ï¼Œå¦‚ä¸Š type
  // ç„¶åè½¬æˆå°å†™å­—æ¯
  return Object.prototype.toString.call(data).slice(8, -1).toLowerCase();
}

/**
 * å…·ä½“å®ç°æ·±æ‹·è´
 */
function deepclone(source) {
  let t = type(source);
  // åˆ¤æ–­æ•°æ®ç±»å‹
  if (t !== "object" && t !== "array") {
    // ç®€å•æ•°æ®ç±»å‹ä¸éœ€è¦æ·±æ‹·è´å¤„ç†
    return source;
  }
  let clo;
  if (t === "object") {
    clo = {};
    for (let attr in source) {
      if (source.hasOwnProperty(attr)) {
        clo[attr] = deepclone(source[attr]); // é€’å½’
      }
    }
  } else if (t === "array") {
    clo = [];
    for (let i = 0; i < source.length; i++) {
      clo[i] = deepclone(source[i]); // é€’å½’
    }
  }
  return clo;
}

module.exports = {
  deepclone,
};
```

å®Œæˆä¹‹åï¼Œå†™ä¸ªç®€å•çš„æµ‹è¯•ä»£ç :

```javascript
const { deepclone } = require("./index.js");

let cat = {
  name: "Bell",
  sex: "female",
  age: 2,
  children: [
    { name: "Bert", sex: "male", age: 0.3 },
    { name: "Boston", sex: "male", age: 0.3 },
  ],
};

let cat2 = deepclone(cat);

cat2.name = "Jack";
cat2.children[1].sex = "female";
cat2.children[1].age = 0.4;

console.log(cat);
console.log(cat2);
```

æµ‹è¯•é€šè¿‡ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š

![1](../image/module_develop/1.jpg)

æˆ‘ä»¬å¯ä»¥çœ‹è§ï¼Œå¯ä»¥å®ç°æˆ‘ä»¬éœ€è¦çš„æ•ˆæœï¼Œå¹¶æ²¡æœ‰æ”¹å˜åŸå˜é‡ cat çš„å€¼ã€‚

## æ„å»º

è¿™ä¸€æ­¥ä¸»è¦æ˜¯å°†ä»¥ä¸Šå†™çš„ä»£ç ä¾æ®ä¸€å®šçš„è§„åˆ™ï¼ˆè§„èŒƒï¼‰å°è£…æˆä¸€ä¸ªæˆ–å¤šä¸ªå—ï¼ˆæ–‡ä»¶ï¼‰ï¼Œå¹¶ç»„åˆåœ¨ä¸€èµ·ã€‚ï¼ˆå†…éƒ¨æ•°æ®ä¸å®ç°æ˜¯ç§æœ‰çš„, åªæ˜¯å‘å¤–éƒ¨æš´éœ²ä¸€äº›æ¥å£(æ–¹æ³•)ä¸å¤–éƒ¨å…¶å®ƒæ¨¡å—é€šä¿¡ï¼‰ã€‚

### æ¨¡å—è§„èŒƒ

è¿™é‡Œå°±ä¸å¾—ä¸å¾—å±•å¼€è®²è®²æ¨¡å—åŒ–çš„ä¸€äº›è§„èŒƒäº†ã€‚æ¨¡å—è§„èŒƒä¸»è¦åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šæ¨¡å—å¼•ç”¨ã€æ¨¡å—å®šä¹‰ã€æ¨¡å—æ ‡è¯†ã€‚åŒæ—¶ï¼Œæ¨¡å—è§„èŒƒå¾ˆå¥½åœ°è§£å†³å˜é‡æ±¡æŸ“é—®é¢˜ï¼Œæ¯ä¸ªæ¨¡å—å…·æœ‰ç‹¬ç«‹ç©ºé—´ï¼Œäº’ä¸å¹²æ‰°ï¼Œå‘½åç©ºé—´ç­‰æ–¹æ¡ˆä¸ä¹‹ç›¸æ¯”ç›¸å½¢è§ç»Œã€‚æ¨¡å—è§„èŒƒæ”¯æŒå¼•å…¥å’Œå¯¼å‡ºåŠŸèƒ½ï¼Œè¿™æ ·å¯ä»¥é¡ºç•…åœ°è¿æ¥å„ä¸ªæ¨¡å—ï¼Œå®ç°å½¼æ­¤é—´çš„ä¾èµ–å…³ç³»ã€‚ç°æœ‰çš„ä¸»æµ javascript æ¨¡å—è§„èŒƒæœ‰ UMDã€ESMã€AMDã€CMD å’Œ Common JSã€‚

#### UMD

ä¸¥æ ¼ä¸Šè¯´ï¼ŒUMD ä¸èƒ½ç®—æ˜¯ä¸€ç§æ¨¡å—è§„èŒƒï¼Œå› ä¸ºå®ƒæ²¡æœ‰æ¨¡å—å®šä¹‰å’Œè°ƒç”¨ï¼Œè¿™æ˜¯ AMD å’Œ CommonJS çš„ç»“åˆä½“ï¼Œä¿è¯æ¨¡å—å¯ä»¥è¢« AMD å’Œ commonjs è°ƒç”¨ï¼Œæ¨¡å—çš„åŠ è½½ä¸å½±å“å®ƒåé¢è¯­å¥çš„è¿è¡Œã€‚æ‰€æœ‰ä¾èµ–è¿™ä¸ªæ¨¡å—çš„è¯­å¥ï¼Œéƒ½å®šä¹‰åœ¨ä¸€ä¸ªå›è°ƒå‡½æ•°ä¸­ï¼Œç­‰åˆ°åŠ è½½å®Œæˆä¹‹åï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°æ‰ä¼šè¿è¡Œã€‚

#### AMD

æœ€å¤è€çš„æ¨¡å—åŒ–ç³»ç»Ÿï¼Œå…¸å‹ä»£è¡¨æ˜¯ requirejsã€‚å¼‚æ­¥æ¨¡å—å®šä¹‰ï¼ˆç¼©å†™ä¸º Asynchronous Module Definitionï¼‰ï¼Œé‡‡ç”¨å¼‚æ­¥æ–¹å¼åŠ è½½æ¨¡å—ï¼Œä¸”å¯ä»¥å¹¶è¡ŒåŠ è½½å¤šä¸ªæ¨¡å—ã€‚

#### CMD

CMD (Common Module Definition), æ˜¯ seajs æ¨å´‡çš„è§„èŒƒï¼ŒCMD åˆ™æ˜¯ä¾èµ–å°±è¿‘ï¼Œä¸ AMD ä¸€æ ·ï¼Œä¹Ÿæ˜¯é‡‡ç”¨ç‰¹å®šçš„ define()å‡½æ•°æ¥å®šä¹‰ï¼Œç”¨ require æ–¹å¼æ¥å¼•ç”¨æ¨¡å—ã€‚ä¸“é—¨ç”¨äºæµè§ˆå™¨ç«¯ï¼Œå€Ÿé‰´äº† Commonjs çš„è§„èŒƒä¸ AMD è§„èŒƒã€‚

> CMD ä¸ AMD åŒºåˆ«
>
> - AMD å’Œ CMD æœ€å¤§çš„åŒºåˆ«æ˜¯å¯¹ä¾èµ–æ¨¡å—çš„æ‰§è¡Œæ—¶æœºå¤„ç†ä¸åŒï¼Œè€Œä¸æ˜¯åŠ è½½çš„æ—¶æœºæˆ–è€…æ–¹å¼ä¸åŒï¼ŒäºŒè€…çš†ä¸ºå¼‚æ­¥åŠ è½½æ¨¡å—ã€‚
> - AMD ä¾èµ–å‰ç½®ï¼Œjs å¯ä»¥æ–¹ä¾¿çŸ¥é“ä¾èµ–æ¨¡å—æ˜¯è°ï¼Œç«‹å³åŠ è½½ï¼›
> - CMD ä¾èµ–å°±è¿‘ï¼Œéœ€è¦ä½¿ç”¨æŠŠæ¨¡å—å˜ä¸ºå­—ç¬¦ä¸²è§£æä¸€éæ‰çŸ¥é“ä¾èµ–äº†é‚£äº›æ¨¡å—ï¼Œè¿™ä¹Ÿæ˜¯å¾ˆå¤šäººè¯Ÿç—… CMD çš„ä¸€ç‚¹ï¼Œç‰ºç‰²æ€§èƒ½æ¥å¸¦æ¥å¼€å‘çš„ä¾¿åˆ©æ€§ï¼Œå®é™…ä¸Šè§£ææ¨¡å—ç”¨çš„æ—¶é—´çŸ­åˆ°å¯ä»¥å¿½ç•¥ã€‚

#### Common JS

æœåŠ¡ç«¯æ¨¡å—è§„èŒƒï¼Œé€‚ç”¨äº Node ç¯å¢ƒå’Œå…¶ä»–æ‰“åŒ…å·¥å…·ã€‚å› ä¸ºä»–æ˜¯åŒæ­¥åŠ è½½æ¨¡å—ï¼Œæ‰€ä»¥æ›´é€‚ç”¨äºæœåŠ¡å™¨ç«¯ï¼ˆä¸é€‚åˆæµè§ˆå™¨ç¯å¢ƒï¼Œå­˜åœ¨é˜»å¡åŠ è½½ï¼‰ã€‚å¯ä»¥è¿™æ ·ç†è§£ï¼Œå°†æ‰€æœ‰æœåŠ¡å™¨éœ€è¦çš„æ¨¡æ‰€æœ‰å—ä¸€èµ·å­˜å‚¨åœ¨æœåŠ¡å™¨æœ¬åœ°ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœç¡¬ç›˜è¯»å–æ—¶é—´ç­‰ç­‰ï¼ŒåŠ å¿«äº†è®¿é—®æˆ–å…¶ä»–æ“ä½œçš„é€Ÿåº¦ç­‰ï¼›è€Œå¦‚æœæ˜¯æµè§ˆå™¨ä¹Ÿä½¿ç”¨è¿™ç§åŒæ­¥åŠ è½½ï¼Œé‚£ä¹ˆåªèƒ½ç­‰å¾…ä¾èµ–åŒ…åŠ è½½å®Œæˆåæ‰èƒ½æ‰§è¡Œå…·ä½“çš„é€»è¾‘ä»£ç ï¼Œè¿™æ˜æ˜¾åŠ é•¿äº†ç­‰å¾…æ—¶é—´ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨å¼‚æ­¥åŠ è½½ï¼Œä¹Ÿå°±æ˜¯ AMD è§„èŒƒã€‚

#### ESM

2015 å¹´ï¼ŒES6 è§„èŒƒå°†æ¨¡å—åŒ–çº³å…¥ JavaScript æ ‡å‡†ï¼Œå…³é”®å­—æœ‰ importï¼Œexportï¼Œdefaultï¼Œasï¼Œfromã€‚ESM æ˜¯æµè§ˆå™¨å’ŒæœåŠ¡å™¨é€šç”¨çš„æ¨¡å—è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨ Node ç¯å¢ƒä¸­ä»ç„¶å¸¸ç”¨ CJSï¼ˆCommon JSï¼‰ã€‚

> CJS ä¸ ESM åŒºåˆ«
>
> - CJS æ¨¡å—è¾“å‡ºçš„æ˜¯ä¸€ä¸ªå€¼çš„æ‹·è´ï¼ˆæ¨¡å—å†…å€¼å’Œå¼•ç”¨å€¼ä¹‹é—´æ”¹å˜æ—¶äº’ä¸å½±å“ï¼‰ï¼Œè€Œ ESM æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„åªè¯»å¼•ç”¨ï¼Œå½“æ”¹å˜æ¨¡å—å†…å€¼æ—¶ï¼Œå¼•ç”¨å€¼ä¹Ÿæ”¹å˜ã€‚
> - CJS æ¨¡å—æ˜¯è¿è¡Œæ—¶åŠ è½½ï¼Œä¸”åŠ è½½çš„æ˜¯æ•´ä¸ªæ¨¡å—ï¼Œä¹Ÿå°±æ˜¯è¯´å°†æ‰€æœ‰çš„æ¥å£å…¨éƒ¨åŠ è½½è¿›æ¥ï¼›è€Œ ESM æ¨¡å—æ˜¯ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£ï¼Œå¯ä»¥å•ç‹¬åŠ è½½å…¶ä¸­çš„æŸä¸ªæ¥å£ã€‚

### æ‰“åŒ…ä½“ç³»

åˆ†ä¸ºä¼ ç»Ÿä½“ç³»ã€Node.js ä½“ç³»å’Œå·¥å…·åŒ–ä½“ç³»ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„å½“ç„¶åº”è¯¥æ˜¯å·¥ç¨‹åŒ–ä½“ç³»ï¼Œå…¶æ¨¡å—è§„èŒƒä¸º ESM+CJSï¼Œç›¸åº”çš„å·¥å…·ä¸º Webpackã€Rollup ç­‰ï¼ˆæ¨¡å—åŒ–æ¯”è¾ƒå¤æ‚æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ Rollup å°†å°æ¨¡å—æ‰“åŒ…ï¼Œç„¶åç”¨ Webpack å°†æ•´ä½“æ‰“åŒ…ï¼‰ã€‚

### å…·ä½“æ‰“åŒ…

è¿™é‡Œçš„æ‰“åŒ…ï¼Œæˆ‘ä»¬ä½¿ç”¨ Rollupã€‚Rollup æ˜¯ä¸€ä¸ªæ¨¡å—æ‰“åŒ…å™¨ï¼Œæ”¯æŒ ES6 æ¨¡å—ï¼Œæ”¯æŒ Tree-shakingï¼ˆæ‘‡æ ‘ä¼˜åŒ–ï¼‰ï¼Œä½†ä¸æ”¯æŒ webpack çš„ code-splittingã€æ¨¡å—çƒ­æ›´æ–°ç­‰ï¼Œè¿™æ„å‘³ç€å®ƒæ›´é€‚åˆç”¨æ¥åšç±»åº“é¡¹ç›®çš„æ‰“åŒ…å™¨è€Œä¸æ˜¯åº”ç”¨ç¨‹åºé¡¹ç›®çš„æ‰“åŒ…å™¨ï¼Œåº”ç”¨ç¨‹åºé¡¹ç›®çš„æ‰“åŒ…å™¨æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ webpack ç­‰ã€‚

> è¿™é‡Œå…ˆæŒ–ä¸ªå‘ï¼ŒRollup çš„åº•å±‚åŸç†ç­‰çŸ¥è¯†æˆ‘ä»¬ä¸‹ä¸€ç¯‡å†å­¦ã€‚

#### Rollup å®‰è£…

å°† Rollup ä½œä¸ºå¼€å‘ä¾èµ–è¿›è¡Œå®‰è£…ï¼š

```shell
npm install rollup --include=dev # æˆ–è€…å¦‚ä¸‹
yarn add rollup --dev
```

ç„¶ååœ¨ node_modules ä¸­æ‰¾åˆ° rollup åŒ…ï¼Œè¿›å…¥ dist/bin/ä¸‹ï¼Œæ‰¾åˆ° rollupï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œ node rollupï¼Œæ•ˆæœå¦‚ä¸‹ï¼š

```shell
(base) bert@BertdeMacBook-Air bin % node rollup

rollup version 3.20.2
=====================================

Usage: rollup [options] <entry file>

Basic options:

-c, --config <filename>     Use this config file (if argument is used but value
                              is unspecified, defaults to rollup.config.js)
-d, --dir <dirname>         Directory for chunks (if absent, prints to stdout)
-e, --external <ids>        Comma-separate list of module IDs to exclude
-f, --format <format>       Type of output (amd, cjs, es, iife, umd, system)
-g, --globals <pairs>       Comma-separate list of `moduleID:Global` pairs
-h, --help                  Show this help message
-i, --input <filename>      Input (alternative to <entry file>)
-m, --sourcemap             Generate sourcemap (`-m inline` for inline map)
-n, --name <name>           Name for UMD export
-o, --file <output>         Single output file (if absent, prints to stdout)
-p, --plugin <plugin>       Use the plugin specified (may be repeated)
-v, --version               Show version number
-w, --watch                 Watch files in bundle and rebuild on changes
# è¿™é‡Œç•¥å»ä¸€éƒ¨åˆ†

Examples:

# use settings in config file
rollup -c

# in config file, process.env.INCLUDE_DEPS === 'true'
# and process.env.BUILD === 'production'
rollup -c --environment INCLUDE_DEPS,BUILD:production

# create CommonJS bundle.js from src/main.js
rollup --format=cjs --file=bundle.js -- src/main.js

# create self-executing IIFE using `window.jQuery`
# and `window._` as external globals
rollup -f iife --globals jquery:jQuery,lodash:_ \
  -i src/app.js -o build/app.js -m build/app.js.map

Notes:

* When piping to stdout, only inline sourcemaps are permitted

For more information visit https://rollupjs.org
```

è¡¨æ˜ä¸‹è½½æ— è¯¯ï¼Œè¿™é‡Œå·²ç»å¯ä»¥ç›´æ¥ä½¿ç”¨ rollup äº†ï¼Œæ¯”å¦‚ä¸‹é¢çš„å‘½ä»¤ï¼š

```shell
# å¯¹åº”ä¸‰ä¸ªå‚æ•°åˆ†åˆ«ä¸ºï¼šéœ€è¦æ‰“åŒ…çš„æ–‡ä»¶ç›®å½•ã€æ‰“åŒ…è¾“å‡ºæ ¼å¼ï¼ˆé‡‡ç”¨umdï¼‰ã€æ‰“åŒ…åè¾“å‡ºçš„æ–‡ä»¶å
node rollup ../src/index.js --format umd --file dist/deepclone.js
```

æˆ‘ä»¬é€‰æ‹©ç”¨é…ç½®æ–‡ä»¶çš„æ–¹å¼å»é…ç½®æ‰“åŒ…è¿‡ç¨‹ä¸­çš„å„é¡¹å‚æ•°ã€‚é¦–å…ˆåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œæ–°å»º rollup.config.js é…ç½®æ–‡ä»¶ï¼Œæ‰§è¡Œ rollup å‘½ä»¤æ—¶éœ€è¦åŠ ä¸Š--configï¼Œè¡¨æ˜è¯»å–é…ç½®æ–‡ä»¶å†æ‰“åŒ…ï¼Œå› ä¸ºä»–é»˜è®¤æ˜¯ä¸è¯»å–é…ç½®æ–‡ä»¶çš„ã€‚

é…ç½®æ–‡ä»¶ä¸­è¿™æ ·æ¥å†™ï¼š

```javascript
module.exports = {
  input: "../../src/index.js", // è¿™é‡Œå’Œoutputä¸­çš„fileï¼Œåšä¸»è§£é‡Šä¸‹ï¼š
  output: {
    // æˆ‘æ˜¯åœ¨nodeâ€”modulesä¸­çš„.binç›®å½•ä¸‹æ‰§è¡Œçš„rollupå‘½ä»¤ï¼Œæ‰€ä»¥
    file: "../../src/dist/index.js", // é…ç½®æ–‡ä»¶ä¸­çš„ç›®å½•è·¯å¾„ç­‰éƒ½æ˜¯
    format: "umd", // ç›¸å¯¹node-modules/.bin/çš„ï¼Œå¤§å®¶åˆ«è¢«æˆ‘æè¿·ç³Šäº†
    name: "deepclone",
  },
};
```

ç»ˆç«¯æ‰§è¡Œæ•ˆæœå¦‚ä¸‹ï¼š

```shell
(base) bert@BertdeMacBook-Air .bin % node rollup -c ../../rollup.config.js

../../src/index.js â†’ dist/index.js...
created dist/index.js in 20ms
```

å¹¶ä¸”æ–°å¢æ–‡ä»¶ç›®å½•å¦‚ä¸‹ï¼š

![3](../image/module_develop/3.png)

æ‰“åŒ…åçš„ä»£ç å¦‚ä¸‹ï¼š

![4](../image/module_develop/4.png)

## æµ‹è¯•

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ä»£ç å·²ç»è¢«å°è£…æˆäº†åŸºç¡€åº“ï¼Œä½†æ˜¯è¿™è¿œæ²¡æœ‰ç»“æŸï¼Œæˆ‘ä»¬è¿˜éœ€è¦å»ä¿è¯ä»£ç çš„è´¨é‡ï¼Œå› æ­¤éœ€è¦å¯¹ä»–åšå¤šç»´åº¦çš„å•å…ƒæµ‹è¯•ã€‚

> å•å…ƒæµ‹è¯•åˆ†ä¸ºæµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰å’Œè¡Œä¸ºé©±åŠ¨å¼€å‘ï¼ˆBDDï¼‰ã€‚
> TDD å¼€å‘æ–¹å¼ï¼šä¸¤é¡¶å¸½å­ â€”â€”â€”â€” ç¬¬ä¸€é¡¶ï¼šå®ç°åŠŸèƒ½ï¼Œç„¶åæµ‹è¯•è¾…åŠ©å¿«é€Ÿå®ç°åŠŸèƒ½ï¼›ç¬¬äºŒé¡¶ï¼šé‡æ„ä»£ç ï¼ˆåœ¨å®ç°åŠŸèƒ½ä¹‹åï¼‰ï¼Œæµ‹è¯•ä¿æŠ¤ä¸‹åˆ é™¤å†—ä½™ä»£ç ã€‚ä»¥æ­¤æé«˜ä»£ç è´¨é‡ã€‚
> BDD å¼€å‘æ–¹å¼ï¼šå¼€å‘ã€qa å’ŒéæŠ€æœ¯äººå‘˜æˆ–å•†ä¸šå‚ä¸è€…ä¹‹é—´æœ‰æ•ˆåä½œï¼Œé‡ç‚¹æ˜¯é€šè¿‡ä¸åˆ©ç›Šç›¸å…³è€…çš„è®¨è®ºï¼Œå¯¹é¢„æœŸè½¯ä»¶è¡Œä¸ºæœ‰æ¸…é†’è®¤çŸ¥ã€‚

æˆ‘ä»¬è¿™é‡Œé‡‡ç”¨ BDD å¼€å‘æ–¹å¼ï¼Œä¾èµ–åº“é‡‡ç”¨ï¼š

```shell
  "expect.js": "^0.3.1",
  "mocha": "^3.5.3",
```

æµ‹è¯•æµç¨‹è¿™é‡Œå°±ä¸ç»†è®²äº†ï¼ŒåŒ…å«è®¾è®¡æµ‹è¯•ç”¨ä¾‹ã€éªŒè¯æµ‹è¯•è¦†ç›–ç‡ã€æµè§ˆå™¨ç¯å¢ƒæµ‹è¯•ã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚
åœ¨ç»è¿‡å¯¹å‡½æ•°çš„å‚æ•°ï¼ˆæˆ‘ä»¬è¿™é‡Œæ˜¯å•å‚æ•°ï¼‰è¿›è¡Œåˆ†æåï¼Œè®¾è®¡å…·ä½“çš„æµ‹è¯•ç”¨ä¾‹ï¼Œç¼–å†™æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š

```javascript
/*
 * @Description: å•å…ƒæµ‹è¯•
 * @Author: Bert
 * @Date: 2023-03-29 21:15:39
 * @LastEditors: Bert
 * @LastEditTime: 2023-03-29 23:47:54
 */
var { describe, it } = require("mocha");
var expect = require("expect.js");
var deepclone = require("./src/index.js").deepclone;

describe("function clone", function () {
  describe("param data", function () {
    it("æ­£ç¡®", function () {
      // åŸºæœ¬æ•°æ®ç±»å‹
      expect(deepclone("abc")).to.equal("abc");

      // æ•°ç»„
      var arr = [1, 2, 3];
      var cloneArray = deepclone(arr);
      expect(cloneArray.toString()).to.equal(arr.toString());
      cloneArray[0] = 4;
      expect(cloneArray.toString()).not.to.equal(arr);

      // å¯¹è±¡
      var obj = { cat: { name: "Bob", age: "2" } };
      var cloneObj = deepclone(obj);
      expect(JSON.stringify(cloneObj)).to.equal(JSON.stringify(obj));
      cloneObj.cat.name = "Bert";
      expect(JSON.stringify(cloneObj)).not.to.equal(JSON.stringify(obj));
    });

    // æ— é”™è¯¯æµ‹è¯•ç”¨ä¾‹

    // è¾¹ç•Œå€¼ä¸º undefined null
    it("è¾¹ç•Œå€¼", function () {
      expect(deepclone(1)).not.to.equal(undefined);
      expect(deepclone(undefined)).to.equal(undefined);
      expect(deepclone(null)).to.equal(null);
    });
  });
});
```

æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š

![2](../image/module_develop/2.png)

æ¥ä¸‹æ¥è¿˜åº”è¯¥å»éªŒè¯æˆ‘ä»¬æµ‹è¯•çš„è¦†ç›–ç‡ï¼ŒåŒ…æ‹¬å¯¹æ–‡ä»¶ã€è¯­å¥ã€å‡½æ•°ã€è¡Œç­‰ç­‰ï¼ˆå¯ä»¥ä½¿ç”¨è¦†ç›–ç‡æ”¶é›†å·¥å…· nycï¼Œæ˜¯è¦†ç›–ç‡å·¥å…· istanbul çš„å‘½ä»¤è¡Œç‰ˆæœ¬ï¼‰ï¼›
é‚£ä¹ˆæˆªæ­¢åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»åœ¨ node ç¯å¢ƒä¸­æµ‹è¯•å®Œæˆäº†ï¼›
ç„¶åæˆ‘ä»¬éœ€è¦ç”¨æµè§ˆå™¨çš„ç¯å¢ƒè¿›è¡Œæµ‹è¯•ï¼ŒåŒ…æ‹¬æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒï¼ˆå¯ä»¥ä½¿ç”¨ jsdom-globalï¼‰å’Œç”¨çœŸå®çš„æµè§ˆå™¨ç¯å¢ƒï¼›
æµ‹è¯•çš„æœ€åä¸€æ­¥å°±æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå¯ä»¥ä½¿ç”¨ puppeteer å¯åŠ¨ Chrome Headless æµ‹è¯•ã€‚

å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå°±å¯ä»¥ä½¿ç”¨ Jest æµ‹è¯•æ¡†æ¶è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œè¿™é‡Œé™„ä¸Šä»–çš„å®˜ç½‘åœ°å€ï¼š

Jest å®˜æ–¹ç½‘ç«™[ç‚¹å‡»è·³è½¬](https://www.jestjs.cn/docs/getting-started)

UI è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Œä½¿ç”¨ Cypressï¼Œå®˜ç½‘åœ°å€ï¼š

Cypress å®˜æ–¹ç½‘ç«™[ç‚¹å‡»è·³è½¬](https://docs.cypress.io/guides/getting-started/installing-cypress)

## å¼€æº

### åè®®

ä»£ç å®Œæˆå’Œæµ‹è¯•é€šè¿‡åï¼Œè‡ªç„¶åº”è¯¥è€ƒè™‘å…¬å¼€æºä»£ç äº†ã€‚æˆ‘ä»¬å¯ä»¥æŠŠä»£ç å‘å¸ƒåˆ° github ä¸Šæˆ–è€…æŠŠæ‰“åŒ…åçš„ä»£ç å‘å¸ƒåˆ° npm ä¸Šã€‚

ä½†æ˜¯ï¼ï¼ï¼

ä»£ç å…¬å¼€æˆ‘ä»¬éœ€è¦å¼•å…¥ç›¸åº”çš„åè®®ï¼Œç›®å‰å‡ ç§å¼€æºåè®®ï¼šMITã€BSDã€Apacheï¼Œæˆ‘ä»¬è‡ªå·±çš„å¼€æºåº“çš„è¯å¤§å¤šæ•°æƒ…å†µä¸‹ä¹Ÿæ˜¯é‡‡ç”¨ MIT åè®®ã€‚

### æ–‡æ¡£

æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›è¯´æ˜æ–‡æ¡£çš„ï¼Œè¯´æ˜æˆ‘ä»¬çš„ä»£ç åŠŸèƒ½ã€åç»­å·¥ä½œã€å˜æ›´æ—¥å¿—ã€API æ¥å£ã€‚

README.md æ–‡æ¡£ï¼š

![5](../image/module_develop/5.png)

TODO.md æ–‡æ¡£ï¼š

![6](../image/module_develop/6.png)

CHANGELOG.md æ–‡æ¡£ï¼š

![7](../image/module_develop/7.png)

API.md æ–‡æ¡£ï¼š

![8](../image/module_develop/8.png)

å½“ç„¶ï¼Œå†…å®¹è¾ƒå°‘æ—¶ï¼Œæˆ‘ä»¬å®Œå…¨ä¹Ÿå¯ä»¥æ”¾åœ¨åŒä¸€ä¸ªæ–‡æ¡£ï¼ŒREADME.md é‡Œã€‚

### å‘å¸ƒ

åœ¨å‡†å¤‡å¥½åè®®å’Œè¯´æ˜æ–‡æ¡£åï¼Œ

- æˆ‘ä»¬å¯ä»¥æŠŠæºä»£ç ç›´æ¥ä¸Šä¼ åˆ° Github ä¸Šï¼Œç„¶åå»æ¨å¹¿ï¼›
- ä¹Ÿå¯ä»¥æŒ‰ç…§ npm å®˜æ–¹æ–‡æ¡£ï¼Œå‘å¸ƒåˆ° npm ä¸Šï¼Œæ“ä½œè¯·çœ‹å®˜æ–¹æ–‡æ¡£åœ°å€[æŸ¥çœ‹](https://docs.npmjs.com/creating-and-publishing-unscoped-public-packages)ã€‚

### ç»Ÿè®¡

æˆ‘ä»¬æ—¶å¸¸ä¼šå…³å¿ƒè‡ªå·±çš„åº“æˆ–ä»£ç æ˜¯å¦æœ‰æ›´å¤šçš„å°ä¼™ä¼´å‘ç°å¹¶å¼•ç”¨ï¼Œå› æ­¤éœ€è¦ç»Ÿè®¡ï¼š

- Github ç›´æ¥çœ‹ star æ•°é‡å³å¯ï¼›
- npm ä¸Šçš„ç»Ÿè®¡ï¼Œä»…çœ‹å®˜æ–¹æä¾›çš„ç»Ÿè®¡è§†å›¾ï¼Œnpm ä¸‹è½½å…¶å®å¹¶ä¸å‡†ç¡®ï¼Œå› ä¸ºå›½å†…çš„ä¸€äº›å°ä¼™ä¼´ç”¨çš„å¯èƒ½æ˜¯æ·˜å®é•œåƒå•Šï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ç»Ÿè®¡ï¼Œä¹Ÿå°±æ˜¯ç”¨ npm æä¾›çš„é’©å­ã€‚

npm æä¾›çš„é’©å­æœ‰ pre å’Œ post ä¸¤ç§ï¼Œå¯¹åº”å„ä¸ªå‘½ä»¤åï¼Œå¦‚ä¸‹ï¼š

- prepublishï¼Œpostpublish
- preinstallï¼Œpostinstall
- preuninstallï¼Œpostuninstall
- preversionï¼Œpostversion
- pretestï¼Œposttest
- prestopï¼Œpoststop
- prestartï¼Œpoststart
- prerestartï¼Œpostrestart

é‚£æˆ‘ä»¬è¿™é‡Œç»Ÿè®¡çš„è¯ä¸€èˆ¬å°±æ˜¯ç”¨ preinstall æˆ–è€… postinstall å•¦ï½
ä½¿ç”¨æ–¹å¼å°±æ˜¯åœ¨ package.json çš„ script éƒ¨åˆ†å®šä¹‰ preinstall å’Œ postinstallï¼Œç„¶å install æ—¶ä¼šæŒ‰ç…§ preinstallã€instalã€postinstall çš„é¡ºåºæ‰§è¡Œã€‚
æ¯”å¦‚ï¼š

```javascript
{   // åœ¨package.jsonä¸­å®šä¹‰postinstallå¯¹åº”çš„å‘½ä»¤ï¼Œ
  "scripts": {
    "postinstall": "node postinstall.js"
  }
}
```

å‘½ä»¤ä¸­å¯¹åº”çš„ postinstall.js æ–‡ä»¶å¦‚ä¸‹ï¼š

```javascript
// postinstall.jsæ–‡ä»¶
const axios = require('axios').default;

axios.get('/install/count').then({function ({
  console.log(response);
  });
});
```

## ç»´æŠ¤

åœ¨æœ‰äº†ä¸€ä¸ªåŸºç¡€åº“ä¹‹åï¼Œæˆ‘ä»¬æ—¥å¸¸è¿˜éœ€è¦èŠ±æ—¶é—´å»ç»´æŠ¤æˆ‘ä»¬çš„åº“ã€‚æ¶‰åŠåˆ°çš„ä¸œè¥¿æœ‰ï¼šIssueï¼ˆæ±‚åŠ©ç±» help wantedã€æ•…éšœç±» bugã€å»ºè®®ç±» enhancementï¼‰ã€è´¡çŒ®ä»£ç ï¼ˆåŒ…å«åº“å¼€å‘äººå‘˜å’Œéåº“å¼€å‘äººå‘˜ Fork+PRï¼‰ã€‚

æˆ‘ä»¬è¿˜éœ€è¦å°†æ„å»ºè¿‡ç¨‹è‡ªåŠ¨åŒ–ï¼Œä½¿å…¶ç»è¿‡ç¼–è¯‘ã€å‘å¸ƒå’Œè‡ªåŠ¨åŒ–æµ‹è¯•éªŒè¯æ˜¯å¦å­˜åœ¨é”™è¯¯ç­‰ç­‰ï¼Œå¦å¤–æ³¨æ„ä»“åº“åˆ†æ”¯çš„å¤„ç†ã€‚

## å…¶ä»–éœ€è¦æ³¨æ„çš„

ä¸ºäº†æä¾›ä¸€ä¸ªè¾ƒå¥½çš„ js åº“ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„ä¸€äº›æ–¹é¢ï¼Œæ¯”å¦‚ï¼š

1ã€å‡½æ•°ç¼–å†™

- å‡½æ•°å‘½åéœ€è¦ç®€æ´æ„èµ…ï¼Œè§åçŸ¥æ„ã€‚
- å‡½æ•°å‚æ•°å°½é‡å°‘ä¸€äº›ï¼Œå°½é‡ä¸è¶…è¿‡ä¸‰ä¸ªï¼Œå‚æ•°è¾ƒå¤šæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ options æ¨¡å¼ã€‚

2ã€ä»£ç å¥å£®æ€§

- å‚æ•°é˜²å¾¡ï¼Œå¯¹äºç”¨æˆ·å¯èƒ½ä¼šè¾“å…¥é¢„æ–™ä¹‹å¤–çš„å‚æ•°æœ‰é˜²å¾¡æ€§æªæ–½ã€‚
- å‰¯ä½œç”¨å¤„ç†ï¼Œ
- å¼‚å¸¸æ•è·ï¼Œéœ€è¦ç»™ç”¨æˆ·æ˜ç¡®çš„æç¤ºã€‚

3ã€æµè§ˆå™¨å…¼å®¹
å‚è€ƒè‡ªå·±å¼€å‘çš„åº“çš„å®šä½ï¼Œå»åšç›¸åº”çš„å…¼å®¹å³å¯ã€‚

## å®‰å…¨é˜²æŠ¤

å­¦ä¹ ä¸­â€¦â€¦
